<!DOCTYPE html>
<html th:replace="layouts/main::main(~{::div}, ~{::script}, ~{::link})" xmlns="http://www.w3.org/1999/html">

<link th:href="@{/plugins/datatables/dataTables.bootstrap4.min.css}" rel="stylesheet" type="text/css" />
<link th:href="@{/plugins/datatables/buttons.bootstrap4.min.css}" rel="stylesheet" type="text/css" />
<link th:href="@{/plugins/datatables/responsive.bootstrap4.min.css}" rel="stylesheet" type="text/css" />

<div class="content">
    <div class="container-fluid">
        <div class="row">
            <div class="col-12">

                <div class="card">
                    <div class="card-header"th:text="#{whitelist.title}"></div>
                    <div class="card-body">
                        <ul class="nav nav-tabs">
                            <li class="nav-item">
                                <a href="#whitelist" data-toggle="tab" aria-expanded="true" class="nav-link active">Белый лист</a>
                            </li>
                            <li class="nav-item">
                                <a href="#groups" data-toggle="tab" aria-expanded="false" class="nav-link">Группы</a>
                            </li>
                            <li class="nav-item">
                                <a href="#categories" data-toggle="tab" aria-expanded="false" class="nav-link">Виды белого листа</a>
                            </li>
                        </ul>
                        <div class="tab-content">
                            <div class="tab-pane fade show active" id="whitelist">
                                <table id="datatable-buttons" class="table table-bordered table-bordered">
                                    <thead>
                                    <tr>
                                        <th><a th:text="#{ordinal.number}"></a></th>
                                        <th><a th:text="#{whitelist.categoryName}"></a></th>
                                        <th><a th:text="#{car.platenumber}"></a></th>
                                        <th><a th:text="#{whitelist.groupName}"></a></th>
                                        <th><a th:text="#{whitelist.condition}"></a></th>
                                        <p sec:authorize="hasAnyRole('ROLE_MANAGER', 'ROLE_OWNER', 'ROLE_ADMIN')">
                                        <th></th>
                                        <th></th>
                                        </p>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr th:each="w, iterStat : ${whitelist}">
                                        <td th:text="${iterStat.count}"></td>
                                        <td>
                                            <span th:if="${w.group != null && w.group.category != null}" th:text="${w.group.category.name}"></span>
                                            <span th:if="${w.group == null && w.category != null}" th:text="${w.category.name}"></span>
                                        </td>
                                        <td><span th:text="${w.car.platenumber}"></span></td>
                                        <td>
                                            <span th:if="${w.group != null}" th:text="${w.group.name}"></span>
                                        </td>
                                        <td th:text="${w.conditionDetail}"></td>
                                        <p sec:authorize="hasAnyRole('ROLE_MANAGER', 'ROLE_OWNER', 'ROLE_ADMIN')">
                                        <td><a th:href="@{|/whitelist/edit/${w.id}|}" th:text="#{crm.edit}"></a></td>
                                        </p>
                                        <p sec:authorize="hasAnyRole('ROLE_MANAGER', 'ROLE_OWNER', 'ROLE_ADMIN')">
                                        <td><a th:href="@{|/whitelist/delete/${w.id}|}" th:text="#{crm.delete}"></a></td>
                                        </p>
                                    </tr>
                                    </tbody>
                                </table>
                                <p sec:authorize="hasAnyRole('ROLE_OWNER', 'ROLE_ADMIN')">
                                <div class="form-group row">
                                    <div class="col-12">
                                        <a th:href="@{|/whitelist/add|}" class="btn btn-danger waves-effect waves-light" th:text="#{whitelist.addNew}"></a>
                                        <a th:href="@{|/whitelist/groups/add|}" class="btn btn-danger waves-effect waves-light" th:text="#{whitelist.addNewGroup}"></a>
                                    </div>
                                </div>
                                </p>
                            </div>
                            <div class="tab-pane fade" id="groups">
                                <table id="datatable-buttons1" class="table table-bordered table-bordered">
                                    <thead>
                                    <tr>
                                        <th><a th:text="#{ordinal.number}"></a></th>
                                        <th><a th:text="#{whitelist.categoryName}"></a></th>
                                        <th><a th:text="#{whitelist.groupName}"></a></th>
                                        <th><a th:text="#{whitelist.groupSize}"></a></th>
                                        <th><a th:text="#{whitelist.condition}"></a></th>
                                        <p sec:authorize="hasAnyRole('ROLE_MANAGER', 'ROLE_OWNER', 'ROLE_ADMIN')">
                                        <th></th>
                                        <th></th>
                                        </p>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr th:each="w, iterStat : ${whitelistGroups}">
                                        <td th:text="${iterStat.count}"></td>
                                        <td>
                                            <span th:if="${w.category != null}" th:text="${w.category.name}"></span>
                                        </td>
                                        <td th:text="${w.name}"></td>
                                        <td th:text="${w.size}"></td>
                                        <td th:text="${w.conditionDetail}"></td>
                                        <p sec:authorize="hasAnyRole('ROLE_MANAGER', 'ROLE_OWNER', 'ROLE_ADMIN')">
                                        <td><a th:href="@{|/whitelist/group/edit/${w.id}|}" th:text="#{crm.edit}"></a></td>
                                        </p>
                                        <p sec:authorize="hasAnyRole('ROLE_MANAGER', 'ROLE_OWNER', 'ROLE_ADMIN')">
                                        <td><a th:href="@{|/whitelist/group/delete/${w.id}|}" th:text="#{crm.delete}"></a></td>
                                        </p>
                                    </tr>
                                    </tbody>
                                </table>
                                <p sec:authorize="hasAnyRole('ROLE_OWNER', 'ROLE_ADMIN')">
                                <div class="form-group row">
                                    <div class="col-12">
                                        <a th:href="@{|/whitelist/groups/add|}" class="btn btn-danger waves-effect waves-light" th:text="#{whitelist.addNewGroup}"></a>
                                    </div>
                                </div>
                                </p>
                            </div>
                            <div class="tab-pane fade" id="categories">
                                <table id="datatable-buttons2" class="table table-bordered table-bordered">
                                    <thead>
                                    <tr>
                                        <th><a th:text="#{ordinal.number}"></a></th>
                                        <th><a th:text="#{category.name}"></a></th>
                                        <p sec:authorize="hasAnyRole('ROLE_MANAGER', 'ROLE_OWNER', 'ROLE_ADMIN')">
                                        <th></th>
                                        </p>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr th:each="cat, iterStat : ${categories}">
                                        <td th:text="${iterStat.count}"></td>
                                        <td th:text="${cat.name}"></td>
                                        <p sec:authorize="hasAnyRole('ROLE_MANAGER', 'ROLE_OWNER', 'ROLE_ADMIN')">
                                        <td>
                                            <a href="#" data-toggle="modal" data-target="#category-close-modal" th:categoryId="${cat.id}" th:onclick="categoryModalContent(this.getAttribute('categoryId'))">
                                                <i class="ion-edit"></i>
                                            </a>
                                            </a></td>
                                        </p>
                                    </tr>
                                    </tbody>
                                </table>
                                <p sec:authorize="hasAnyRole('ROLE_OWNER', 'ROLE_ADMIN')">
                                <div class="form-group row">
                                    <div class="col-12">
                                        <button data-toggle="modal" data-target="#category-close-modal" class="btn btn-danger waves-effect waves-light"
                                                th:text="#{category.addNew}" th:onclick="categoryModalContent(null)"></button>
                                    </div>
                                </div>
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="category-close-modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="display: none;">
        <div class="modal-dialog">
            <div class="modal-content">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                <div class="modal-header">
                    <h4 class="modal-title">Форма категории</h4>
                </div>
                <div class="modal-body" id="categoryModalBody">
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Required datatable js -->
<script th:src="@{/plugins/datatables/jquery.dataTables.min.js}"></script>
<script th:src="@{/plugins/datatables/dataTables.bootstrap4.min.js}"></script>
<!-- Buttons examples -->
<script th:src="@{/plugins/datatables/dataTables.buttons.min.js}"></script>
<script th:src="@{/plugins/datatables/buttons.bootstrap4.min.js}"></script>
<script th:src="@{/plugins/datatables/jszip.min.js}"></script>
<script th:src="@{/plugins/datatables/pdfmake.min.js}"></script>
<script th:src="@{/plugins/datatables/vfs_fonts.js}"></script>
<script th:src="@{/plugins/datatables/buttons.html5.min.js}"></script>
<script th:src="@{/plugins/datatables/buttons.print.min.js}"></script>
<script th:src="@{/plugins/datatables/buttons.colVis.min.js}"></script>
<!-- Responsive examples -->
<script th:src="@{/plugins/datatables/dataTables.responsive.min.js}"></script>
<script th:src="@{/plugins/datatables/responsive.bootstrap4.min.js}"></script>

<script type="text/javascript">
    var table = $('#datatable-buttons').DataTable({
        lengthChange: false,
        buttons: ['copy', 'excel', 'pdf', 'csv'],
        language: {
            url: '/plugins/datatables/json/ru.json'
        }
    });

    var table1 = $('#datatable-buttons1').DataTable({
        lengthChange: false,
        buttons: ['copy', 'excel', 'pdf', 'csv'],
        language: {
            url: '/plugins/datatables/json/ru.json'
        }
    });

    table.buttons().container()
        .appendTo('#datatable-buttons_wrapper .col-md-6:eq(0)');

    table1.buttons().container()
        .appendTo('#datatable-buttons1_wrapper .col-md-6:eq(0)');

    function groupModalContent(groupId){
        if(groupId){
            $.get("/whitelist/group/" + groupId, function (data) {
                $('#group-close-modal').find('#groupModalBody').html(data);
            });
        }
    }
    function categoryModalContent(categoryId){
        if(categoryId){
            $.get("/whitelist/category/edit/" + categoryId, function (data) {
                $('#category-close-modal').find('#categoryModalBody').html(data);
            });
        } else {
            $.get("/whitelist/category/add", function (data) {
                $('#category-close-modal').find('#categoryModalBody').html(data);
            });
        }
    }
</script>

</html>
