<!DOCTYPE html>
<html th:replace="layouts/main::main(~{::div}, ~{::script}, ~{::link})" xmlns="http://www.w3.org/1999/html">

<link th:href="@{/plugins/datatables/dataTables.bootstrap4.min.css}" rel="stylesheet" type="text/css"/>
<link th:href="@{/plugins/datatables/buttons.bootstrap4.min.css}" rel="stylesheet" type="text/css"/>
<link th:href="@{/plugins/datatables/responsive.bootstrap4.min.css}" rel="stylesheet" type="text/css"/>

<div class="content">
	<div class="container">
		<div class="card table-responsive table-striped">
			<div class="card-body">
				<div class="infoboard">
					<div class="row">
						<h4 class="col" th:text="#{infoboard.parking}"></h4>
						<select class="col form-control selectParking" id="selectParking">
							<option value="" th:text="#{parking.parkings}"></option>
							<option th:each="r : ${parkings}" th:value="${r.id}" th:text="${r.name}">
							</option>
						</select>
					</div>
					<div class="row">
						<h4 class="col" th:text="#{infoboard.gate}"></h4>
						<select class="col form-control selectGate" id="selectGate">
							<option selected disabled th:text="#{events.gate}"></option>
						</select>
					</div>
					<div class="row">
						<h4 class="col car-info" th:text="#{infoboard.platenumber}"></h4>
						<h4 class="col car-info" id="platenumber"></h4>
					</div>
					<div class="row">
						<h4 class="col car-info" th:text="#{infoboard.duration}"></h4>
						<h4 class="col car-info" id="parking-duration"></h4>
					</div>
					<div class="row">
						<h4 class="col car-info" th:text="#{infoboard.amount}"></h4>
						<h4 class="col car-info" id="total-amount"></h4>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>

<script type="text/javascript" th:inline="javascript">
	$(document).ready(function () {
		$("#selectParking").change(function () {
			select_parking();
		});

	});
	function select_parking() {
		var parkingId = $("#selectParking").val();

		$.ajax({
			type: "GET",
			contentType: "application/json",
			url: "/infoboard/list/"+parkingId,
			dataType:'json',
			cache: false,
			success: function (data) {
				console.log("data", data)
				var options = "<option selected disabled th:text=\"#{events.gate}\"></option>"
				$.each(data, function(index, value) {
					options += "<option value=\""+value.id+"\">"+value.name+" </option>"

					console.log("index", index)
					console.log("value", value)

				});

				$('#selectGate').html(options);
				console.log("SUCCESS : ", data);
			},
			error: function (e) {
				console.log("ERROR : ", e);
			}
		});
	}

	$(document).ready(function () {
		$("#selectGate").change(function () {
			select_gate();
		});
	});

	function select_gate(){
		let gateId = $("#selectGate").val();
		$.ajax({
			type: "GET",
			contentType: "application/json",
			url: "/infoboard/carstate?gateId=" + gateId,
			dataType:'json',
			cache: false,
			success: function (data) {
				console.log("data", data)
				let carNumber = "<h4 className=\"col car-info\" id=\"platenumber\">" + data.carNumber + "</h4>"
				let duration = "<h4 className=\"col car-info\" id=\"parking-duration\">" + data.duration + "</h4>"
				let amount = "<h4 className=\"col car-info\" id=\"total-amount\">" + data.rateAmount + "</h4>"

				console.log("data.plateNumber", carNumber)

				$('#platenumber').html(carNumber);
				$('#parking-duration').html(duration);
				$('#total-amount').html(amount);
				console.log("SUCCESS : ", data);
			},
			error: function (e) {
				console.log("ERROR : ", e);
			}
		});
	}


</script>

</html>